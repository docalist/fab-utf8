<def name="icons" value="/FabWeb/modules/AdminSchemas/EditSchema/images" />
<div id="SchemaEditor">
/*    <h1>Editeur de schéma : $file</h1> */
    
    /*
        Arborescence de gauche : liste les noeuds du schéma.
    */
    <div id="schema">
        <ul style="display: none"> /* évite de voir apparaître l'arbre non stylisé */
            <li id="root" rel="Schema" 
                data-properties="{$this->nodeProperties($schema)}">
                <a>Schéma $file</a>
                <ul>
                    <loop on="{$schema->collections}" as="$name, $collection">
                        <li rel="Collection" id="collection" 
                            data-properties="{$this->nodeProperties($collection)}">
                            <a>$name</a>
                            <ul>
                                <loop on="{$collection->fields}" as="$name, $field">
                                    <li rel="Field" 
                                        data-properties="{$this->nodeProperties($field)}">
                                        <a>$name</a>
                                    </li>
                                </loop>
                                <loop on="{$collection->aliases}" as="$name, $alias">
                                    <li rel="Alias" 
                                    data-properties="{$this->nodeProperties($alias)}">
                                        <a>$name</a>
                                    </li>
                                </loop>
                            </ul>
                        </li>
                    </loop>
                </ul>
            </li>
        </ul>
    </div>
    
    /*
        Editeur de propriétés : affiche les propriétés du noeud sélectionné.
    */
    <form id="form" class="form">
        <div id="schema-toolbar"></div>
        <table><tbody></tbody></table>
    </form>
    
    /*
        Formulaire (caché) utilisé pour enregistrer le schéma : le code javascript sérialize 
        le schéma en JSON, le stocke dans la textarea puis soumet le formulaire.
    */
    <form id="saveform" method="post" action="SaveSchema" style="display: none">
        <hidden name="file" value="$file" />
        <textarea name="schema"></textarea>
    </form> 
</div>

<script type="text/javascript">
    jQuery(document).ready(function() \{
    	 jQuery('#schema').schemaEditor({$schema->toJson()}, {json_encode($config)});
	\});    
</script>